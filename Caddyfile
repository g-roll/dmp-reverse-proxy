{
    # Admin API deaktivieren für Sicherheit
    admin off
    
    # Storage für SSL Zertifikate
    storage file_system {
        root /data
    }

    # On-demand TLS für dynamische Domains
    on_demand_tls {
        ask http://localhost:5000/verify
    }
}

# Global Site Block für alle Domains
:443, :80 {
    # TLS Konfiguration
    tls {
        on_demand
        protocols tls1.2 tls1.3
    }

    # Match für Container-spezifische Domains
    @container {
        host *
    }

    handle @container {
        reverse_proxy {$SERVICE_NAME:localhost}:{$PORT:80}
    }

    # HTTP zu HTTPS Redirect
    handle {
        redir https://{host}{uri} permanent
    }

    # Logging
    log {
        output stdout
        format json
    }
}
