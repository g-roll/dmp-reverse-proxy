{
    # Admin API deaktivieren für Sicherheit
    admin off
    
    # Storage für SSL Zertifikate
    storage file_system {
        root /data
    }

    # On-demand TLS für dynamische Domains
    on_demand_tls {
        ask http://localhost:5000/verify
    }
}

# Globale Catch-all Regel für alle Domains
:443 {
    tls {
        on_demand
    }

    # Match für Container-spezifische Domains
    @container {
        host *
    }

    handle @container {
        reverse_proxy {$SERVICE_NAME:localhost}:{$PORT:80}
    }
}

# HTTP zu HTTPS Redirect
:80 {
    redir https://{host}{uri} permanent
}